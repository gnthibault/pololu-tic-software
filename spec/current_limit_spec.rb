require_relative 'spec_helper'

TicRecommendedCurrentCodeDump = <<END
T825
0,0
1,32
2,64
3,96
4,128
5,160
6,192
7,224
8,256
9,288
10,320
11,352
12,384
13,416
14,448
15,480
16,512
17,544
18,576
19,608
20,640
21,672
22,704
23,736
24,768
25,800
26,832
27,864
28,896
29,928
30,960
31,992
32,1024
34,1088
36,1152
38,1216
40,1280
42,1344
44,1408
46,1472
48,1536
50,1600
52,1664
54,1728
56,1792
58,1856
60,1920
62,1984
64,2048
68,2176
72,2304
76,2432
80,2560
84,2688
88,2816
92,2944
96,3072
100,3200
104,3328
108,3456
112,3584
116,3712
120,3840
124,3968
T834
0,0
1,32
2,64
3,96
4,128
5,160
6,192
7,224
8,256
9,288
10,320
11,352
12,384
13,416
14,448
15,480
16,512
17,544
18,576
19,608
20,640
21,672
22,704
23,736
24,768
25,800
26,832
27,864
28,896
29,928
30,960
31,992
32,1024
34,1088
36,1152
38,1216
40,1280
42,1344
44,1408
46,1472
48,1536
50,1600
52,1664
54,1728
56,1792
58,1856
60,1920
62,1984
64,2048
68,2176
72,2304
76,2432
80,2560
84,2688
88,2816
92,2944
96,3072
100,3200
104,3328
108,3456
T500
0,0
1,1
2,174
3,343
4,495
5,634
6,762
7,880
8,990
9,1092
10,1189
11,1281
12,1368
13,1452
14,1532
15,1611
16,1687
17,1762
18,1835
19,1909
20,1982
21,2056
22,2131
23,2207
24,2285
25,2366
26,2451
27,2540
28,2634
29,2734
30,2843
31,2962
32,3093
END

describe 'current limit code' do
  it 'works' do
    # The C++ side tests a lot of things about the current limit.  We run it to
    # make sure there are no errors, that the set of recommended codes hasn't
    # changed by accident, and we also check to make sure it up-to-date and is
    # actually testing every product.
    stdout, stderr, code = run_ticcmd('--test 3')
    expect(stderr).to eq ''
    expect(stdout).to eq TicRecommendedCurrentCodeDump
    expect(code).to eq 0

    TicProductSymbols.each do |sym|
      expect(stdout).to include(sym.to_s)
    end
  end
end
